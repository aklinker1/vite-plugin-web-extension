---
lang: en-US
title: Migrate from v1
---

# Migrate from v1

There have been several breaking changes in the upgrade to v2. Most of these changes are to simplify the configuration and reply more on standards provided by Vite rather than using custom options.

[[toc]]

## Drop CommonJS Support

In your `package.json`, it's now required to add `"type": "module"` due to `web-ext` dropping support.

If you have any config files like tailwind that were common JS, rename them to use the `.cjs` file extension.

## No More `assets` Option

In v1, everything in the `assets` directory was copied to the output directory. That sound familiar? Well, that's exactly what the [`public` directory](https://vitejs.dev/guide/assets.html#the-public-directory) does.

If your config used to look like this:

```ts:no-line-numbers
export default defineConfig({
    root: path.resolve(__dirname, "src"),
    plugins: [
        webExtension({
            manifest: "manifest.json",
            assets: "assets"
        })
    ]
})
```

To migrate, move all your assets into the `<root>/public` directory and delete the `assets` option from your config.

```bash:no-line-numbers
mkdir src/public
git mv src/assets/* src/public
```

```diff:no-line-numbers
webExtension({
    manifest: "manifest.json",
-   assets: "assets"
})
```

## Default `manifest` Option

By default, the `manifest` option in the plugin's configuration will be `"manifest.json"`, meaning you can remove that option entirly if you were using that as the filename.

```diff:no-line-numbers
webExtension({
-   manifest: "manifest.json",
    ...
})
```

If you're using a different file to generate your manifest, no changes are required.

If you're using a function to generate your manifest, no changes are required. But you should consider adding any files responsible for generating your manifest to the `watchFilePaths` option. See the next section for more details.

## Dev/Watch Mode Changes

Whenever you change the file defined in your `manifest` option, the browser will automatically restart and reinstall your extension. This should help you iterate faster when updating permissions, content scripts, or any other change you might make.

If you're using a function to generate your manifest, to take advantage of this new behavior you'll need to manually add all files that generate your manifest to the `watchFilePaths` option.

## `web-ext` Changes

`web-ext` was upgraded from v6.5 &rarr; v7.2. The big change here is that the library now ships with only module support, not as common JS. See [Drop CommonJS Support](#drop-commonjs-support) for what you need to do.

In addition to the upgrade, the `webExtConfig` option has been removed. Instead, you should now configure this as a separate, gitignored file. Since this file is usually used for configuring and tweaking how the browser runs on your personal computer, not the rest of the team, excluding it from the plugin config makes sense.

The plugin uses `cosmiconfig` to load `web-ext`'s configuration from your file. For a full list of possible filenames, see the [source code](https://github.com/aklinker1/vite-plugin-web-extension/blob/b3111ddabcf4ff30239eeaa11ff88f6208dd2cf5/packages/vite-plugin-web-extension/src/utils/extension-runner.ts#L26-L46). For a full list of configuration you can list in this file, see [`web-ext`'s source code](https://github.com/mozilla/web-ext/blob/e37e60a2738478f512f1255c537133321f301771/src/cmd/run.js#L28-L62).

## No More `generated:` Prefix

In v1, you prefixed a file in the input manifest with `generated:` to list it as required in the final `manifest.json`, but that it shouldn't be treated as a input that needs built. This was mostly used for CSS files generated by JS inputs.

In v2, the final `manifest.json` is filled out automatically based on your build output! So just remove any files prefixed with `generated:`, and it will magically work!

## Build Process Changes

In v1, the main build step bunbled your HTML entrypoints, and follow-up build steps built your content scripts, background page, and other entrypoints.

In v2, the main build step now just writes the `manifest.json` to the output directory. HTML entrypoints, content scripts, the background script, and additional entrypoints are all built in "children" steps.

> The new build output and logging clearly states what files are being built when, so check that out if you're curious to learn more.

In watch and dev mode, the child build processes now happen in series instead of in parallel.

All these changes have several effects on builds:

- The **generated files can be automatically added to the final manifest** (see [No More `generated:` Prefix](#no-more-generated-prefix))
- **Less memory is consumed** because it only holds the manifest and a single in-progress build in memory at one time
- **No more multiple reloads** during a single rebuild in watch mode!
- **Build extensions without a UI**, you no longer have to specify a `dummy.html` when your manifest doesn't include an HTML entrypoint

## Removed options

- `assets`: See [No More `assets` Option](#no-more-assets-option)
- `writeAssetsTo`: Without an `assets` option, this does nothing
- `writeManifestTo`: To change where the extension builds to, use [Vite's `build.outDir`](https://vitejs.dev/config/build-options.html#build-outdir) option instead
- `verbose`: Use the `--debug` flag when performing a build (`vite build --debug`) to see more output
- `serviceWorkerType`: Deprecated field has been removed. As of [v1.0.3](https://github.com/aklinker1/vite-plugin-web-extension/releases/tag/v1.0.3), this option has had no effect, so you can just remove it
- `webExtConfig`: Use an external config file, see [`web-ext` Changes](#web-ext-changes) for more details
